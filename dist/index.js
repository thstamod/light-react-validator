var r=require("react");function n(){return(n=Object.assign||function(r){for(var n=1;n<arguments.length;n++){var e=arguments[n];for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(r[t]=e[t])}return r}).apply(this,arguments)}var e=function(r){return Array.isArray(r)?!r.length:0===Object.keys(r).length&&r.constructor===Object},t=function(r){return Array.isArray(r)},u={required:function(r){return"string"==typeof r?r.trim().length>0:"number"==typeof r?!!r:!(!r||"object"!=typeof r||e(r))},email:function(r){return/^\w+([-]?\w+)*@\w+([-]?\w+)*(\.\w{2,3})+$/.test(r)},minLength:function(r,n){return n||console.warn("length is not provided"),r.toString().length>=n},maxLength:function(r,n){return n||console.warn("length is not provided"),r.toString().length<=n},minCheckboxes:function(r,n){return void 0===n&&(n=null),!("object"!=typeof r||!t(r)||!n||"number"!=typeof n)&&r.length>=n}},o=function(r,n,e,t){var u;return(null==t||null===(u=t.customValidators)||void 0===u?void 0:u[e])?t.customValidators[e]:(null==r?void 0:r[e])?r[e]:n[e]?n[e]:void console.warn("no validation function with mane "+e)},c=function(r){return"radio"===r.type},i=function(r){return"checkbox"===r.type},l=function(r){if("checkbox"===r.type||"radio"===r.type){if(r.ref)return r.ref.current&&r.ref.current.checked?r.ref.current.value:null;if(!e(r.group)&&t(r.group))return r.group.filter(function(r){return r.current.checked}).map(function(r){return r.current.value})}return r.ref.current?r.ref.current.value:null},a=function(r,n,e){var t,u;return void 0===r&&(r=null),void 0===n&&(n=null),(null===(t=r)||void 0===t?void 0:t[e])||(null===(u=n)||void 0===u?void 0:u[e])||void 0},v=function(r){return function(n){return r||console.warn(n),r}},f=function(r,n){return r&&n in r};exports.useValidator=function(t){var d=r.useRef(new Map),s=r.useRef(new Map),p=r.useRef(new Map),g=r.useRef({}),m=r.useRef(!1),h=r.useRef(!0),y=r.useRef(!1),b=r.useState()[1];r.useEffect(function(){d.current.forEach(function(r){var n;("object"==typeof(n=l(r))&&null!==n?!e(n):"number"==typeof n?n||0===n:"string"==typeof n?n.trim():n)&&w(r)})},[]);var w=function(r){var u=!0,o=n({},g.current),c=d.current.get(r.name)||{},i=c.validators,s=c.name,p=c.fieldRules||{},m=p.rules,w=p.messages,R=p.options;if(m&&s)for(var k in i){var O=i[k],j=a(R,null==t?void 0:t.globalOptions,k),E=l(r);if(m[k]&&!O(E,j)){var L;if(u=!1,f(null===(L=g.current)||void 0===L?void 0:L[s],k))continue;y.current=!0;var M=v(a(w,null==t?void 0:t.globalMessages,k))("no @ "+k+" error message anywhere for "+s+" input.");g.current[s]=g.current[s]||{},g.current[s][k]=M,d.current.set(s,n({},d.current.get(s),{valid:!1}))}else{var x,S,V,A,q,F,P;if(!(null===(x=g.current)||void 0===x||null===(S=x[s])||void 0===S?void 0:S[k]))continue;y.current=!0,null===(V=g.current)||void 0===V||null===(A=V[s])||void 0===A||delete A[k],!e(null==g?void 0:g.current)&&e(null==g||null===(q=g.current)||void 0===q?void 0:q[s])&&(e(null===(F=g.current)||void 0===F?void 0:F[s])&&(null===(P=g.current)||void 0===P||delete P[s]),g.current=n({},g.current),d.current.set(s,n({},d.current.get(s),{valid:!0})))}}u||(h.current=!1),e(g.current)&&!e(o)&&(y.current=!0,h.current=!0),y.current&&(y.current=!1,b({}))};return{track:function(e,l){var a;if(e){var v=r.createRef();v.current=e;var f=function(r){return r.name||void console.warn("the field @ "+r.outerHTML+" must have a unique name attribute")}(v.current);if(f){var g,h=c(v.current)||i(v.current),y=d.current.get(f);d.current.has(f)&&(null==y?void 0:y.group)&&y.group.some(function(r){return r.current===v.current})||(c(v.current)||i(v.current)||"range"===(null===(g=v.current)||void 0===g?void 0:g.type)?v.current&&v.current.addEventListener("change",function(r){return function(n){var e;if(n.stopPropagation(),m.current||!(null==t?void 0:t.validateFormOnSubmit)){var u=null===(e=r.current)||void 0===e?void 0:e.name,o=r.current&&d.current.get(u);w(o)}}}(v)):(v.current&&v.current.addEventListener("focus",function r(n){return function(){var e;s.current.set(null===(e=n.current)||void 0===e?void 0:e.name,null),n.current&&n.current.removeEventListener("focus",r(n),!0)}}(v)),v.current&&v.current.addEventListener("input",function(r){return function(n){var e;n.stopPropagation();var u=null===(e=r.current)||void 0===e?void 0:e.name;if(p.current.has(r.current)||p.current.set(r.current,null),m.current||!(null==t?void 0:t.validateFormOnSubmit)){var o=d.current.get(u);w(o)}}}(v))));var b=function(r,n,e){if(e){var t={};for(var u in null==e?void 0:e.rules){var c=o(r,n,u,e);c&&(t[u]=c)}return t}}(null==t?void 0:t.customValidators,u,l),R=d.current.get(f)||n({valid:!0},l&&{fieldRules:l},b&&{validators:b},{type:null===(a=v.current)||void 0===a?void 0:a.type,name:f},h&&{checked:!1},h&&{group:[]},{ref:v});d.current.has(f)&&(R.ref&&R.group&&R.group.push(R.ref),R.group&&!R.group.some(function(r){return r.current===v.current})&&(R.group.push(v),delete R.ref)),d.current.set(f,R)}}},submitForm:function(r){return function(n){n.preventDefault();var e=h.current;d.current.size!==p.current.size&&(p.current=new Map(d.current)),d.current.forEach(function(r){w(r)}),m.current=!0,h.current===e?r&&r():b({})}},errors:g.current,formValidity:h.current}};
//# sourceMappingURL=index.js.map
