{"version":3,"file":"index.modern.js","sources":["../src/utils/builtIns.ts","../src/index.ts"],"sourcesContent":["export default {\n  require: (input: string): boolean => input.trim().length > 0,\n  email: (input: string): boolean =>\n    /^\\w+([-]?\\w+)*@\\w+([-]?\\w+)*(\\.\\w{2,3})+$/.test(input),\n  minLen: (input: string, len: number): boolean => input.toString().length < len\n}\n","// @ts-nocheck\nimport { useRef, useState, useEffect, createRef, RefObject } from 'react'\nimport builtInValidators from './utils/builtIns'\nimport { Config, UseValidator } from './types/configuration'\nimport { DataField, BasicRefs, Rules } from './types/fields'\n\nexport const useValidator = (config?: Config): UseValidator => {\n  const elements = useRef(new Map())\n  const touchedElements = useRef(new Map())\n  const dirtyElements = useRef(new Map())\n  const errors = useRef({})\n  const customValidators = useRef(null)\n  const [validity, setValidity] = useState(true)\n\n  const submitForm = (fn: Function) => (e: Event) => {\n    e.preventDefault()\n    console.log('validator formSubmit')\n    for (const el in elements.current) {\n      fieldValidation(elements.current[el])\n    }\n    fn()\n  }\n\n  useEffect(() => {\n    if (config?.customValidators) {\n      customValidators.current = config.customValidators\n    }\n  }, [])\n\n  // const beforeSubmit = () => {\n  //   // TODO: run all inputs before submit\n  // }\n\n  const fieldValidation = (ref: RefObject<BasicRefs>) => {\n    let _isValid = true\n    const { fieldRules } = elements.current.get(ref.current)\n    // eslint-disable-next-line no-debugger\n    // debugger\n    const validators = getValidators(\n      fieldRules,\n      customValidators.current,\n      builtInValidators\n    )\n    console.log(validators)\n    const { rules, messages } = fieldRules\n    for (const key in validators) {\n      const validator = validators[key]\n      const name = ref.current!.name\n      if (rules[key] && !validator(ref?.current?.value)) {\n        errors.current[name] = {\n          [key]: messages?.[key],\n          ...errors.current[name]\n        }\n        _isValid = false\n      } else {\n        console.log(errors.current[name])\n        delete errors.current?.[name]?.[key]\n        _isValid = true\n      }\n    }\n    return _isValid\n  }\n\n  const keyup = (ref: RefObject<BasicRefs>) => (e: Event) => {\n    if (!dirtyElements.current.has(ref)) {\n      dirtyElements.current.set(ref, null)\n      return\n    }\n    const v = fieldValidation(ref)\n    if (validity !== v) {\n      setValidity((v) => !v)\n    }\n  }\n\n  const getValidators = (\n    data: Rules,\n    configValidators: Config | null,\n    builtInValidators: object\n  ) => {\n    if (!data) return\n    const f = {}\n    for (const key in data?.rules) {\n      console.log(key)\n      const t = checkForValidators(\n        data,\n        configValidators,\n        builtInValidators,\n        key\n      )\n      if (t) {\n        f[key] = t\n      }\n    }\n    return f\n  }\n\n  const checkForValidators = (\n    data: Rules,\n    configValidators: Config | null,\n    builtInValidators: any,\n    name: string\n  ) => {\n    if (data.customValidators?.[name]) {\n      return data.customValidators[name]\n    }\n    if (configValidators?.[name]) {\n      return configValidators[name]\n    }\n    if (builtInValidators[name]) {\n      return builtInValidators[name]\n    } else {\n      throw new Error(`no validation function with mane ${name}`)\n    }\n  }\n\n  const track = (elem?: BasicRefs | null, rules?: Rules): void => {\n    if (!elem) return\n    const ref = createRef()\n\n    ref.current = elem\n    ref.current.addEventListener('focus', partialOnFocus(ref))\n    ref.current.addEventListener('input', keyup(ref))\n    if (elements.current.has(ref)) return\n\n    const dataFields: DataField = {\n      valid: true,\n      ...(rules && { fieldRules: rules })\n    }\n\n    elements.current.set(elem, dataFields)\n  }\n\n  const partialOnFocus = (ref) => () => {\n    console.log('partial focus')\n    touchedElements.current.set(ref, null)\n    ref.current.onfocus = ''\n  }\n\n  return { track: track, submitForm: submitForm, errors: errors.current }\n}\n"],"names":["require","input","trim","length","email","test","minLen","len","toString","useValidator","config","elements","useRef","Map","touchedElements","dirtyElements","errors","customValidators","validity","setValidity","useState","submitForm","fn","e","preventDefault","console","log","el","current","fieldValidation","useEffect","ref","_isValid","fieldRules","get","validators","getValidators","builtInValidators","rules","messages","key","validator","name","value","keyup","has","set","v","data","configValidators","f","t","checkForValidators","Error","track","elem","createRef","addEventListener","partialOnFocus","dataFields","valid","onfocus"],"mappings":"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"}