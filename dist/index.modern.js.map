{"version":3,"file":"index.modern.js","sources":["../src/utils/builtIns.ts","../src/logic/checkValidators.ts","../src/logic/hasNameAttribute.ts","../src/logic/isRadio.ts","../src/logic/isEmpty.ts","../src/logic/isCheckbox.ts","../src/logic/isArray.ts","../src/logic/getValue.ts","../src/index.ts"],"sourcesContent":["export default {\n  required: <T>(value: T): boolean => {\n    if (typeof value === 'string') {\n      return (value as string).trim().length > 0\n    }\n    if (value) {\n      return true\n    }\n    return false\n  },\n  email: (input: string): boolean =>\n    /^\\w+([-]?\\w+)*@\\w+([-]?\\w+)*(\\.\\w{2,3})+$/.test(input),\n  minLen: (input: string, len: number): boolean => input.toString().length < len\n}\n","import { Config } from '../types/configuration'\nimport { Rules } from '../types/fields'\n\nconst checkForValidators = (\n  configValidators: Config | null,\n  builtInValidators: any,\n  name: string,\n  data?: Rules\n) => {\n  if (data?.customValidators?.[name]) {\n    return data.customValidators[name]\n  }\n  if (configValidators?.[name]) {\n    return configValidators[name]\n  }\n  if (builtInValidators[name]) {\n    return builtInValidators[name]\n  } else {\n    throw new Error(`no validation function with mane ${name}`)\n  }\n}\n\nexport const getValidators = (\n  configValidators: Config | null,\n  builtInValidators: object,\n  data?: Rules\n) => {\n  if (!data) return\n  const f = {}\n  for (const key in data?.rules) {\n    const t = checkForValidators(configValidators, builtInValidators, key, data)\n    if (t) {\n      f[key] = t\n    }\n  }\n  return f\n}\n","export const hasNameAttribute = (ref: HTMLInputElement) => {\n  const name = ref.name\n  if (name) {\n    return name\n  } else {\n    console.warn(`the field ${ref.outerHTML} must have a unique name attribute`)\n    return undefined\n  }\n}\n","export const isRadio = (ref: HTMLInputElement) => ref.type === 'radio'\n","export const isEmpty = (o: object): boolean => {\n  if (Array.isArray(o)) {\n    return !o.length\n  }\n  return Object.keys(o).length === 0 && o.constructor === Object\n}\n","export const isCheckbox = (ref: HTMLInputElement) => ref.type === 'checkbox'\n","export const isArray = (a: any) => Array.isArray(a)\n","import { isArray } from './isArray'\nexport const getValue = <T>(v: T, _type: string) => {\n  if (isArray(v)) {\n    ;((v as unknown) as React.MutableRefObject<HTMLInputElement>[]).reduce(\n      (prev, e) => {\n        return e.current.checked || prev\n      },\n      false\n    )\n  }\n}\n","import { useRef, useState, useEffect, createRef, RefObject } from 'react'\nimport builtInValidators from './utils/builtIns'\nimport { Config, UseValidator } from './types/configuration'\nimport { DataField, Rules } from './types/fields'\nimport { getValidators } from './logic/checkValidators'\nimport { hasNameAttribute } from './logic/hasNameAttribute'\nimport { isRadio } from './logic/isRadio'\nimport { isEmpty } from './logic/isEmpty'\nimport { isCheckbox } from './logic/isCheckbox'\nimport { getValue } from './logic/getValue'\n\nexport const useValidator = (config?: Config): UseValidator => {\n  const elements = useRef<Map<string, DataField>>(new Map())\n  const touchedElements = useRef(new Map())\n  const dirtyElements = useRef(new Map())\n  const errors = useRef({})\n  const customValidators = useRef(null)\n  const customConfiguration = useRef<any>({})\n  const triedToSubmit = useRef(false)\n  const formValidity = useRef(true)\n  const shouldRerender = useRef(false)\n  const [, rerender] = useState()\n\n  const submitForm = (fn: Function) => (e: Event) => {\n    e.preventDefault()\n    const prevFormValidity = formValidity.current\n    if (elements.current.size !== dirtyElements.current.size) {\n      dirtyElements.current = new Map(elements.current)\n    }\n    elements.current.forEach((value: DataField) => {\n      fieldValidation(value)\n    })\n    triedToSubmit.current = true\n\n    if (formValidity.current !== prevFormValidity) {\n      rerender({})\n      return\n    }\n    fn()\n  }\n\n  useEffect(() => {\n    if (config?.customValidators) {\n      customValidators.current = config.customValidators\n    }\n    if (config?.validateFormOnSubmit) {\n      customConfiguration.current.validateFormOnSubmit = true\n    }\n  }, [])\n\n  useEffect(() => {\n    // console.log(elements)\n  })\n\n  const fieldValidation = (elem: DataField): void => {\n    let _isValid = true\n    // eslint-disable-next-line no-debugger\n    // debugger\n    const { fieldRules, validators, name, type } =\n      elements.current.get(elem.name!) || {}\n    const { rules, messages } = fieldRules || {}\n    if (rules && name) {\n      for (const key in validators) {\n        const validator = validators[key]\n        const value =\n          type === 'text'\n            ? elem.ref.current?.value\n            : getValue(!isEmpty(elem.group!) ? elem.group : elem.ref, type!)\n        if (rules[key] && !validator(value)) {\n          _isValid = false\n          if (errors.current?.[name]?.[key]) continue\n          shouldRerender.current = true\n          if (name in errors.current) {\n            errors.current[name][key] = messages?.[key]\n          } else {\n            errors.current[name] = {\n              [key]: messages?.[key],\n              ...errors.current[name]\n            }\n          }\n          elements.current.set(name, {\n            ...(elements.current.get(name) as DataField),\n            valid: false\n          })\n        } else {\n          if (!errors.current?.[name]?.[key]) continue\n          shouldRerender.current = true\n          delete errors.current?.[name]?.[key]\n          if (!isEmpty(errors?.current) && isEmpty(errors?.current?.[name])) {\n            isEmpty(errors.current?.[name]) && delete errors.current?.[name]\n            errors.current = { ...errors.current }\n            elements.current.set(name, {\n              ...(elements.current.get(name) as DataField),\n              valid: true\n            })\n          }\n        }\n      }\n    }\n    if (!_isValid) {\n      formValidity.current = false\n    }\n\n    if (isEmpty(errors.current)) {\n      shouldRerender.current = true\n      formValidity.current = true\n    }\n\n    if (shouldRerender.current) {\n      shouldRerender.current = false\n      rerender({})\n    }\n  }\n\n  const detectInput = (ref: RefObject<HTMLInputElement>) => (e: Event) => {\n    e.stopPropagation()\n    const name = ref.current?.name\n    if (!dirtyElements.current.has(ref.current)) {\n      dirtyElements.current.set(ref.current, null)\n    }\n    if (\n      !triedToSubmit.current &&\n      customConfiguration.current.validateFormOnSubmit\n    )\n      return\n    const t = elements.current.get(name!)\n    fieldValidation(t!)\n  }\n\n  const detectChange = (ref: RefObject<HTMLInputElement>) => (e: Event) => {\n    e.stopPropagation()\n    const name = ref.current?.name\n    const t = ref.current && elements.current.get(name!)\n    fieldValidation(t!)\n  }\n\n  const track = (elem: HTMLInputElement, rules?: Rules): void => {\n    if (!elem) return\n    const ref = createRef<HTMLInputElement>()\n    ;(ref as React.MutableRefObject<HTMLInputElement>).current = elem\n    const name = hasNameAttribute(ref.current!)\n    const isRadioOrCheckbox = isRadio(ref.current!) || isCheckbox(ref.current!)\n    if (ref.current?.type === 'radio') {\n      ref.current && ref.current.addEventListener('change', detectChange(ref))\n    } else {\n      if (elements.current.has(name!)) return\n      ref.current && ref.current.addEventListener('focus', detectTouch(ref))\n      ref.current && ref.current.addEventListener('input', detectInput(ref))\n    }\n    const validators = getValidators(\n      customValidators.current,\n      builtInValidators,\n      rules\n    )\n\n    if (!name) return\n    const dataFields: DataField = elements.current.get(name) || {\n      valid: true,\n      ...(rules && { fieldRules: rules }),\n      ...(validators && { validators }),\n      type: ref.current?.type,\n      name: name,\n      ...(isRadioOrCheckbox && { checked: false }),\n      ...(isRadioOrCheckbox && { group: [] }),\n      ref\n    }\n    if (dataFields.group) {\n      dataFields.group.push(ref)\n      delete dataFields.ref\n    }\n    elements.current.set(name, dataFields)\n  }\n\n  const detectTouch = (ref: RefObject<HTMLInputElement>) => () => {\n    touchedElements.current.set(ref, null)\n    ref.current &&\n      ref.current.removeEventListener('focus', detectTouch(ref), true)\n  }\n\n  return {\n    track: track,\n    submitForm: submitForm,\n    errors: errors.current,\n    formValidity: formValidity.current\n  }\n}\n"],"names":["required","value","trim","length","email","input","test","minLen","len","toString","checkForValidators","configValidators","builtInValidators","name","data","customValidators","Error","getValidators","f","key","rules","t","hasNameAttribute","ref","console","warn","outerHTML","undefined","isRadio","type","isEmpty","o","Array","isArray","Object","keys","constructor","isCheckbox","a","getValue","v","_type","reduce","prev","e","current","checked","useValidator","config","elements","useRef","Map","touchedElements","dirtyElements","errors","customConfiguration","triedToSubmit","formValidity","shouldRerender","rerender","useState","submitForm","fn","preventDefault","prevFormValidity","size","forEach","fieldValidation","useEffect","validateFormOnSubmit","elem","_isValid","fieldRules","validators","get","messages","validator","group","set","valid","detectInput","stopPropagation","has","detectChange","track","createRef","isRadioOrCheckbox","addEventListener","detectTouch","dataFields","push","removeEventListener"],"mappings":"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"}