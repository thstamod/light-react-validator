{"version":3,"file":"index.modern.js","sources":["../src/utils/builtIns.ts","../src/logic/checkValidators.ts","../src/logic/checkers.ts","../src/logic/genericFunctions.ts","../src/index.ts"],"sourcesContent":["export default {\n  require: (input: string): boolean => input.trim().length > 0,\n  email: (input: string): boolean =>\n    /^\\w+([-]?\\w+)*@\\w+([-]?\\w+)*(\\.\\w{2,3})+$/.test(input),\n  minLen: (input: string, len: number): boolean => input.toString().length < len\n}\n","import { Config } from '../types/configuration'\nimport { Rules } from '../types/fields'\n\nconst checkForValidators = (\n  configValidators: Config | null,\n  builtInValidators: any,\n  name: string,\n  data?: Rules\n) => {\n  if (data?.customValidators?.[name]) {\n    return data.customValidators[name]\n  }\n  if (configValidators?.[name]) {\n    return configValidators[name]\n  }\n  if (builtInValidators[name]) {\n    return builtInValidators[name]\n  } else {\n    throw new Error(`no validation function with mane ${name}`)\n  }\n}\n\nexport const getValidators = (\n  configValidators: Config | null,\n  builtInValidators: object,\n  data?: Rules\n) => {\n  if (!data) return\n  const f = {}\n  for (const key in data?.rules) {\n    const t = checkForValidators(configValidators, builtInValidators, key, data)\n    if (t) {\n      f[key] = t\n    }\n  }\n  return f\n}\n","import { RefObject } from 'react'\nimport { BasicRefs } from '../types/fields'\n\nexport const hasNameAttribute = (ref: RefObject<BasicRefs>) => {\n  const name = ref.current!.name\n  if (name) {\n    return name\n  } else {\n    throw new Error(\n      `the field ${ref.current?.outerHTML} must have a unique name attribute`\n    )\n  }\n}\n","export const isEmpty = (o: object): boolean => {\n  if (Array.isArray(o)) {\n    return !o.length\n  }\n  return Object.keys(o).length === 0 && o.constructor === Object\n}\n","import { useRef, useState, useEffect, createRef, RefObject } from 'react'\nimport builtInValidators from './utils/builtIns'\nimport { Config, UseValidator } from './types/configuration'\nimport { DataField, BasicRefs, Rules } from './types/fields'\nimport { getValidators } from './logic/checkValidators'\nimport { hasNameAttribute } from './logic/checkers'\nimport { isEmpty } from './logic/genericFunctions'\n\nexport const useValidator = (config?: Config): UseValidator => {\n  const elements = useRef(new Map())\n  const touchedElements = useRef(new Map())\n  const dirtyElements = useRef(new Map())\n  const errors = useRef({})\n  const customValidators = useRef(null)\n  // const validity = useRef(true)\n  const [, rerender] = useState()\n\n  const submitForm = (fn: Function) => (e: Event) => {\n    e.preventDefault()\n    console.log('validator formSubmit')\n    for (const el in elements.current) {\n      fieldValidation(elements.current[el])\n    }\n    fn()\n  }\n\n  useEffect(() => {\n    if (config?.customValidators) {\n      customValidators.current = config.customValidators\n    }\n  }, [])\n\n  const fieldValidation = (ref: RefObject<BasicRefs>): void => {\n    const prev = elements.current.get(ref.current)\n    // const shouldRerender = false\n    let _isValid = true\n    const { fieldRules, validators } = elements.current.get(ref.current)\n    const { rules, messages } = fieldRules\n    for (const key in validators) {\n      const validator = validators[key]\n      const name = hasNameAttribute(ref)\n      if (rules[key] && !validator(ref?.current?.value)) {\n        errors.current[name] = {\n          [key]: messages?.[key],\n          ...errors.current[name]\n        }\n        elements.current.set(ref.current, { ...prev, valid: false })\n        _isValid = false\n      } else {\n        delete errors.current?.[name]?.[key]\n        isEmpty(errors.current?.[name]) && delete errors.current?.[name]\n        errors.current = { ...errors.current }\n        elements.current.set(ref.current, { ...prev, valid: true })\n        _isValid = true\n      }\n    }\n    console.log(_isValid)\n    if (prev !== elements.current.get(ref.current)) {\n      // validity.current = !validity.current\n      rerender({})\n    }\n    // return _isValid\n  }\n\n  const detectInput = (ref: RefObject<BasicRefs>) => (e: Event) => {\n    e.stopPropagation()\n    if (!dirtyElements.current.has(ref)) {\n      dirtyElements.current.set(ref, null)\n      return\n    }\n    fieldValidation(ref)\n  }\n\n  const track = (elem?: BasicRefs, rules?: Rules): void => {\n    if (!elem) return\n    const ref = createRef<BasicRefs>()\n    ;(ref as React.MutableRefObject<BasicRefs>).current = elem\n    if (elements.current.has(ref.current)) return\n    ref.current && ref.current.addEventListener('focus', detectTouch(ref))\n    ref.current && ref.current.addEventListener('input', detectInput(ref))\n\n    const validators = getValidators(\n      customValidators.current,\n      builtInValidators,\n      rules\n    )\n\n    const dataFields: DataField = {\n      valid: true,\n      ...(rules && { fieldRules: rules }),\n      ...(validators && { validators })\n    }\n    console.log(elements)\n    elements.current.set(ref.current, dataFields)\n  }\n\n  const detectTouch = (ref: RefObject<BasicRefs>) => () => {\n    touchedElements.current.set(ref, null)\n    ref.current &&\n      ref.current.removeEventListener('focus', detectTouch(ref), true)\n  }\n\n  return { track: track, submitForm: submitForm, errors: errors.current }\n}\n"],"names":["require","input","trim","length","email","test","minLen","len","toString","checkForValidators","configValidators","builtInValidators","name","data","customValidators","Error","getValidators","f","key","rules","t","hasNameAttribute","ref","current","outerHTML","isEmpty","o","Array","isArray","Object","keys","constructor","useValidator","config","elements","useRef","Map","touchedElements","dirtyElements","errors","rerender","useState","submitForm","fn","e","preventDefault","console","log","el","fieldValidation","useEffect","prev","get","_isValid","fieldRules","validators","messages","validator","value","set","valid","detectInput","stopPropagation","has","track","elem","createRef","addEventListener","detectTouch","dataFields","removeEventListener"],"mappings":"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"}