{"version":3,"file":"index.js","sources":["../src/utils/builtIns.js","../src/index.tsx"],"sourcesContent":["export default {\n  require: (input) => input.trim().length > 0,\n  email: (input) => /^\\w+([-]?\\w+)*@\\w+([-]?\\w+)*(\\.\\w{2,3})+$/.test(input),\n  minLen: (input, len) => input.toString().length < len\n}\n","// @ts-nocheck\nimport { useRef, useState, useEffect, createRef } from 'react'\nimport builtInValidators from './utils/builtIns'\n\nexport const useValidator = (config) => {\n  console.log('rerender useValidator')\n  const elements = useRef(new Map())\n  const touchedElements = useRef(new Map())\n  const dirtyElements = useRef(new Map())\n  const errors = useRef({})\n  const customValidators = useRef(null)\n  const [validity, setValidity] = useState(true)\n\n  const submitForm = (fn) => (e) => {\n    e.preventDefault()\n    console.log('validator formSubmit')\n    for (const el in elements.current) {\n      fieldValidation(el)\n    }\n    fn()\n  }\n\n  useEffect(() => {\n    if (config.customValidators) {\n      customValidators.current = config.customValidators\n    }\n  }, [])\n\n  // const beforeSubmit = () => {\n  //   // TODO: run all inputs before submit\n  // }\n\n  const fieldValidation = (ref) => {\n    let _isValid = true\n    const { data } = elements.current.get(ref.current)\n    const validators = getValidators(\n      data,\n      customValidators.current,\n      builtInValidators\n    )\n    const { rules, msgs } = data\n    for (const key in validators) {\n      const validator = validators[key]\n      const name = ref.current.name\n      if (rules[key] && !validator(ref.current.value)) {\n        // errors.current[name] = [\n        //   msgs?.[key],\n        //   ...(errors.current[name] ? [errors.current[name]] : [])\n        // ]\n        errors.current[name] = { [key]: msgs?.[key], ...errors.current[name] }\n        _isValid = false\n      } else {\n        console.log(errors.current[name])\n        delete errors.current?.[name]?.[key]\n        _isValid = true\n      }\n    }\n    return _isValid\n  }\n\n  const keyup = (ref) => (e) => {\n    console.log(e)\n    if (!dirtyElements.current.has(ref)) {\n      dirtyElements.current.set(ref, null)\n      return\n    }\n    console.log(e)\n    const v = fieldValidation(ref)\n    if (validity !== v) {\n      setValidity((v) => !v)\n    }\n  }\n\n  const getValidators = (data, configValidators, builtInValidators) => {\n    if (!data) return\n    const f = {}\n    for (const key in data?.rules) {\n      console.log(key)\n      const t = checkForValidators(\n        data,\n        configValidators,\n        builtInValidators,\n        key\n      )\n      console.log(t)\n      if (t) {\n        f[key] = t\n      }\n    }\n    return f\n  }\n\n  const checkForValidators = (\n    data,\n    configValidators,\n    builtInValidators,\n    name\n  ) => {\n    if (data.customValidators?.[name]) {\n      return data.customValidators[name]\n    }\n    if (configValidators?.[name]) {\n      return configValidators[name]\n    }\n    if (builtInValidators[name]) {\n      return builtInValidators[name]\n    } else {\n      throw new Error(`no validation function with mane ${name}`)\n    }\n  }\n\n  const track = (elem, rules) => {\n    if (!elem) return\n    const ref = createRef()\n    ref.current = elem\n    ref.current.addEventListener('focus', partialOnFocus(ref))\n    ref.current.addEventListener('input', keyup(ref))\n    if (elements.current.has(ref)) return\n\n    elements.current.set(elem, {\n      valid: true,\n      ...(rules && { data: rules })\n    })\n  }\n\n  // const partialOnChange = (ref) => (e) => {\n  //    dirtyElements.current.set(ref)\n  //   ref.current.onchange = ''\n  // }\n\n  const partialOnFocus = (ref) => () => {\n    console.log('partial focus')\n    touchedElements.current.set(ref, null)\n    ref.current.onfocus = ''\n  }\n\n  return [track, submitForm, errors.current]\n}\n"],"names":["require","input","trim","length","email","test","minLen","len","toString","useValidator","config","console","log","elements","useRef","Map","touchedElements","dirtyElements","errors","customValidators","useState","validity","setValidity","submitForm","fn","e","preventDefault","el","current","fieldValidation","useEffect","ref","_isValid","get","data","validators","getValidators","builtInValidators","rules","msgs","key","validator","name","value","keyup","has","set","v","configValidators","f","t","checkForValidators","Error","track","elem","createRef","addEventListener","partialOnFocus","valid","onfocus"],"mappings":"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"}