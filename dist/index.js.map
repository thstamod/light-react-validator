{"version":3,"file":"index.js","sources":["../src/utils/builtIns.ts","../src/logic/checkValidators.ts","../src/logic/checkers.ts","../src/logic/genericFunctions.ts","../src/index.ts"],"sourcesContent":["export default {\n  require: (input: string): boolean => input.trim().length > 0,\n  email: (input: string): boolean =>\n    /^\\w+([-]?\\w+)*@\\w+([-]?\\w+)*(\\.\\w{2,3})+$/.test(input),\n  minLen: (input: string, len: number): boolean => input.toString().length < len\n}\n","import { Config } from '../types/configuration'\nimport { Rules } from '../types/fields'\n\nconst checkForValidators = (\n  configValidators: Config | null,\n  builtInValidators: any,\n  name: string,\n  data?: Rules\n) => {\n  if (data?.customValidators?.[name]) {\n    return data.customValidators[name]\n  }\n  if (configValidators?.[name]) {\n    return configValidators[name]\n  }\n  if (builtInValidators[name]) {\n    return builtInValidators[name]\n  } else {\n    throw new Error(`no validation function with mane ${name}`)\n  }\n}\n\nexport const getValidators = (\n  configValidators: Config | null,\n  builtInValidators: object,\n  data?: Rules\n) => {\n  if (!data) return\n  const f = {}\n  for (const key in data?.rules) {\n    const t = checkForValidators(configValidators, builtInValidators, key, data)\n    if (t) {\n      f[key] = t\n    }\n  }\n  return f\n}\n","// import { RefObject } from 'react'\nimport { BasicRefs } from '../types/fields'\n\nexport const hasNameAttribute = (ref: BasicRefs) => {\n  const name = ref.name\n  if (name) {\n    return name\n  } else {\n    throw new Error(\n      `the field ${ref.outerHTML} must have a unique name attribute`\n    )\n  }\n}\n","export const isEmpty = (o: object): boolean => {\n  if (Array.isArray(o)) {\n    return !o.length\n  }\n  return Object.keys(o).length === 0 && o.constructor === Object\n}\n","import { useRef, useState, useEffect, createRef, RefObject } from 'react'\nimport builtInValidators from './utils/builtIns'\nimport { Config, UseValidator } from './types/configuration'\nimport { DataField, BasicRefs, Rules } from './types/fields'\nimport { getValidators } from './logic/checkValidators'\nimport { hasNameAttribute } from './logic/checkers'\nimport { isEmpty } from './logic/genericFunctions'\n\nexport const useValidator = (config?: Config): UseValidator => {\n  const elements = useRef(new Map())\n  const touchedElements = useRef(new Map())\n  const dirtyElements = useRef(new Map())\n  const errors = useRef({})\n  const customValidators = useRef(null)\n  const formValidity = useRef(true)\n  const [, rerender] = useState()\n\n  const submitForm = (fn: Function) => (e: Event) => {\n    e.preventDefault()\n    const prevFormValidity = formValidity.current\n    if (elements.current.size !== dirtyElements.current.size) {\n      dirtyElements.current.clear()\n      dirtyElements.current = elements.current\n    }\n    elements.current.forEach((_value: object, key: BasicRefs) => {\n      fieldValidation(key)\n    })\n    if (formValidity.current !== prevFormValidity) {\n      rerender({})\n      return\n    }\n    fn()\n  }\n\n  useEffect(() => {\n    if (config?.customValidators) {\n      customValidators.current = config.customValidators\n    }\n  }, [])\n\n  const fieldValidation = (ref: BasicRefs): void => {\n    const prev = elements.current.get(ref)\n    const { fieldRules, validators } = elements.current.get(ref)\n    const { rules, messages } = fieldRules\n    for (const key in validators) {\n      const validator = validators[key]\n      const name = hasNameAttribute(ref)\n      if (rules[key] && !validator(ref?.value)) {\n        errors.current[name] = {\n          [key]: messages?.[key],\n          ...errors.current[name]\n        }\n        elements.current.set(ref, { ...prev, valid: false })\n      } else {\n        delete errors.current?.[name]?.[key]\n        if (!isEmpty(errors?.current) && isEmpty(errors?.current?.[name])) {\n          isEmpty(errors.current?.[name]) && delete errors.current?.[name]\n          errors.current = { ...errors.current }\n          elements.current.set(ref, { ...prev, valid: true })\n        }\n      }\n    }\n    if (!elements.current.get(ref).valid && formValidity) {\n      formValidity.current = false\n    }\n    if (prev !== elements.current.get(ref)) {\n      rerender({})\n    }\n  }\n\n  const detectInput = (ref: RefObject<BasicRefs>) => (e: Event) => {\n    e.stopPropagation()\n    if (!dirtyElements.current.has(ref.current)) {\n      dirtyElements.current.set(ref.current, null)\n      return\n    }\n    fieldValidation(ref.current!)\n    if (!formValidity.current) {\n      formValidity.current = true\n      rerender({})\n    }\n  }\n\n  const track = (elem?: BasicRefs, rules?: Rules): void => {\n    if (!elem) return\n    const ref = createRef<BasicRefs>()\n    ;(ref as React.MutableRefObject<BasicRefs>).current = elem\n    if (elements.current.has(ref.current)) return\n    ref.current && ref.current.addEventListener('focus', detectTouch(ref))\n    ref.current && ref.current.addEventListener('input', detectInput(ref))\n\n    const validators = getValidators(\n      customValidators.current,\n      builtInValidators,\n      rules\n    )\n\n    const dataFields: DataField = {\n      valid: true,\n      ...(rules && { fieldRules: rules }),\n      ...(validators && { validators })\n    }\n    elements.current.set(ref.current, dataFields)\n  }\n\n  const detectTouch = (ref: RefObject<BasicRefs>) => () => {\n    touchedElements.current.set(ref, null)\n    ref.current &&\n      ref.current.removeEventListener('focus', detectTouch(ref), true)\n  }\n\n  return {\n    track: track,\n    submitForm: submitForm,\n    errors: errors.current,\n    formValidity: formValidity.current\n  }\n}\n"],"names":["require","input","trim","length","email","test","minLen","len","toString","checkForValidators","configValidators","builtInValidators","name","data","customValidators","Error","getValidators","f","key","rules","t","hasNameAttribute","ref","outerHTML","isEmpty","o","Array","isArray","Object","keys","constructor","useValidator","config","elements","useRef","Map","touchedElements","dirtyElements","errors","formValidity","useState","rerender","submitForm","fn","e","preventDefault","prevFormValidity","current","size","clear","forEach","_value","fieldValidation","useEffect","prev","get","fieldRules","validators","messages","validator","value","set","valid","detectInput","stopPropagation","has","track","elem","createRef","addEventListener","detectTouch","dataFields","removeEventListener"],"mappings":"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"}