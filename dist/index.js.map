{"version":3,"file":"index.js","sources":["../src/utils/builtIns.ts","../src/index.ts"],"sourcesContent":["export default {\n  require: (input: string): boolean => input.trim().length > 0,\n  email: (input: string): boolean =>\n    /^\\w+([-]?\\w+)*@\\w+([-]?\\w+)*(\\.\\w{2,3})+$/.test(input),\n  minLen: (input: string, len: number): boolean => input.toString().length < len\n}\n","// @ts-nocheck\nimport { useRef, useState, useEffect, createRef, RefObject } from 'react'\nimport builtInValidators from './utils/builtIns'\nimport { Config, IuseValidator } from './types/configuration'\nimport { DataField, BasicRefs, Rules } from './types/fields'\n\nexport const useValidator = (config?: Config): IuseValidator => {\n  const elements = useRef(new Map())\n  const touchedElements = useRef(new Map())\n  const dirtyElements = useRef(new Map())\n  const errors = useRef({})\n  const customValidators = useRef(null)\n  const [validity, setValidity] = useState(true)\n\n  const submitForm = (fn: Function) => (e: Event) => {\n    e.preventDefault()\n    console.log('validator formSubmit')\n    for (const el in elements.current) {\n      fieldValidation(elements.current[el])\n    }\n    fn()\n  }\n\n  useEffect(() => {\n    if (config?.customValidators) {\n      customValidators.current = config.customValidators\n    }\n  }, [])\n\n  // const beforeSubmit = () => {\n  //   // TODO: run all inputs before submit\n  // }\n\n  const fieldValidation = (ref: RefObject<BasicRefs>) => {\n    let _isValid = true\n    const { fieldRules } = elements.current.get(ref.current)\n    // eslint-disable-next-line no-debugger\n    // debugger\n    const validators = getValidators(\n      fieldRules,\n      customValidators.current,\n      builtInValidators\n    )\n    console.log(validators)\n    const { rules, messages } = fieldRules\n    for (const key in validators) {\n      const validator = validators[key]\n      const name = ref.current?.name\n      if (rules[key] && !validator(ref?.current?.value)) {\n        errors.current[name] = {\n          [key]: messages?.[key],\n          ...errors.current[name]\n        }\n        _isValid = false\n      } else {\n        console.log(errors.current[name])\n        delete errors.current?.[name]?.[key]\n        _isValid = true\n      }\n    }\n    return _isValid\n  }\n\n  const keyup = (ref: RefObject<BasicRefs>) => (e: Event) => {\n    if (!dirtyElements.current.has(ref)) {\n      dirtyElements.current.set(ref, null)\n      return\n    }\n    const v = fieldValidation(ref)\n    if (validity !== v) {\n      setValidity((v) => !v)\n    }\n  }\n\n  const getValidators = (\n    data: Rules,\n    configValidators: Config | null,\n    builtInValidators: object\n  ) => {\n    if (!data) return\n    const f = {}\n    for (const key in data?.rules) {\n      console.log(key)\n      const t = checkForValidators(\n        data,\n        configValidators,\n        builtInValidators,\n        key\n      )\n      if (t) {\n        f[key] = t\n      }\n    }\n    return f\n  }\n\n  const checkForValidators = (\n    data: Rules,\n    configValidators: Config | null,\n    builtInValidators: any,\n    name: string\n  ) => {\n    if (data.customValidators?.[name]) {\n      return data.customValidators[name]\n    }\n    if (configValidators?.[name]) {\n      return configValidators[name]\n    }\n    if (builtInValidators[name]) {\n      return builtInValidators[name]\n    } else {\n      throw new Error(`no validation function with mane ${name}`)\n    }\n  }\n\n  const track = (elem?: BasicRefs | null, rules?: Rules): void => {\n    if (!elem) return\n    const ref = createRef()\n\n    ref.current = elem\n    ref.current.addEventListener('focus', partialOnFocus(ref))\n    ref.current.addEventListener('input', keyup(ref))\n    if (elements.current.has(ref)) return\n\n    const dataFields: DataField = {\n      valid: true,\n      ...(rules && { fieldRules: rules })\n    }\n\n    elements.current.set(elem, dataFields)\n  }\n\n  const partialOnFocus = (ref) => () => {\n    console.log('partial focus')\n    touchedElements.current.set(ref, null)\n    ref.current.onfocus = ''\n  }\n\n  return { track: track, submitForm: submitForm, errors: errors.current }\n}\n"],"names":["require","input","trim","length","email","test","minLen","len","toString","useValidator","config","elements","useRef","Map","touchedElements","dirtyElements","errors","customValidators","useState","validity","setValidity","submitForm","fn","e","preventDefault","console","log","el","current","fieldValidation","useEffect","ref","_isValid","get","fieldRules","validators","getValidators","builtInValidators","rules","messages","key","validator","name","value","keyup","has","set","v","data","configValidators","f","t","checkForValidators","Error","track","elem","createRef","addEventListener","partialOnFocus","dataFields","valid","onfocus"],"mappings":"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"}