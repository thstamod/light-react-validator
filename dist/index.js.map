{"version":3,"file":"index.js","sources":["../src/utils/builtIns.ts","../src/logic/checkValidators.ts","../src/logic/hasNameAttribute.ts","../src/logic/isRadio.ts","../src/logic/findElementsWithSameName.ts","../src/logic/genericFunctions.ts","../src/index.ts"],"sourcesContent":["export default {\n  required: (input: string): boolean => input.trim().length > 0,\n  email: (input: string): boolean =>\n    /^\\w+([-]?\\w+)*@\\w+([-]?\\w+)*(\\.\\w{2,3})+$/.test(input),\n  minLen: (input: string, len: number): boolean => input.toString().length < len\n}\n","import { Config } from '../types/configuration'\nimport { Rules } from '../types/fields'\n\nconst checkForValidators = (\n  configValidators: Config | null,\n  builtInValidators: any,\n  name: string,\n  data?: Rules\n) => {\n  if (data?.customValidators?.[name]) {\n    return data.customValidators[name]\n  }\n  if (configValidators?.[name]) {\n    return configValidators[name]\n  }\n  if (builtInValidators[name]) {\n    return builtInValidators[name]\n  } else {\n    throw new Error(`no validation function with mane ${name}`)\n  }\n}\n\nexport const getValidators = (\n  configValidators: Config | null,\n  builtInValidators: object,\n  data?: Rules\n) => {\n  if (!data) return\n  const f = {}\n  for (const key in data?.rules) {\n    const t = checkForValidators(configValidators, builtInValidators, key, data)\n    if (t) {\n      f[key] = t\n    }\n  }\n  return f\n}\n","// import { RefObject } from 'react'\nimport { BasicRefs } from '../types/fields'\n\nexport const hasNameAttribute = (ref: BasicRefs) => {\n  const name = ref.name\n  if (name) {\n    return name\n  } else {\n    console.warn(`the field ${ref.outerHTML} must have a unique name attribute`)\n    return undefined\n  }\n}\n","import { BasicRefs } from '../types/fields'\n\nexport const isRadio = (ref: BasicRefs) => ref.type === 'radio'\n","import { BasicRefs, DataField } from '../types/fields'\n\nexport const findElementsWithSameName = (\n  elements: React.MutableRefObject<Map<BasicRefs, DataField>>,\n  name: string\n): BasicRefs[] | null => {\n  const sn: BasicRefs[] = []\n  elements.current.forEach((value, key) => {\n    value.name === name && sn.push(key)\n  })\n  return sn.length ? sn : null\n}\n","export const isEmpty = (o: object): boolean => {\n  if (Array.isArray(o)) {\n    return !o.length\n  }\n  return Object.keys(o).length === 0 && o.constructor === Object\n}\n","import { useRef, useState, useEffect, createRef, RefObject } from 'react'\nimport builtInValidators from './utils/builtIns'\nimport { Config, UseValidator } from './types/configuration'\nimport { DataField, BasicRefs, Rules } from './types/fields'\nimport { getValidators } from './logic/checkValidators'\nimport { hasNameAttribute } from './logic/hasNameAttribute'\nimport { isRadio } from './logic/isRadio'\nimport { findElementsWithSameName } from './logic/findElementsWithSameName'\nimport { isEmpty } from './logic/genericFunctions'\n\nexport const useValidator = (config?: Config): UseValidator => {\n  const elements = useRef<Map<BasicRefs, DataField>>(new Map())\n  const touchedElements = useRef(new Map())\n  const dirtyElements = useRef(new Map())\n  const errors = useRef({})\n  const customValidators = useRef(null)\n  const customConfiguration = useRef<any>({})\n  const triedToSubmit = useRef(false)\n  const formValidity = useRef(true)\n  const shouldRerender = useRef(false)\n  const [, rerender] = useState()\n\n  const submitForm = (fn: Function) => (e: Event) => {\n    e.preventDefault()\n    const prevFormValidity = formValidity.current\n    if (elements.current.size !== dirtyElements.current.size) {\n      dirtyElements.current = new Map(elements.current)\n    }\n    elements.current.forEach((_value: DataField, key: BasicRefs) => {\n      fieldValidation(key)\n    })\n    triedToSubmit.current = true\n\n    if (formValidity.current !== prevFormValidity) {\n      rerender({})\n      return\n    }\n    fn()\n  }\n\n  useEffect(() => {\n    if (config?.customValidators) {\n      customValidators.current = config.customValidators\n    }\n    if (config?.validateFormOnSubmit) {\n      customConfiguration.current.validateFormOnSubmit = true\n    }\n  }, [])\n\n  const fieldValidation = (ref: BasicRefs): void => {\n    let _isValid = true\n    const { fieldRules, validators, name } = elements.current.get(ref) || {}\n    const { rules, messages } = fieldRules || {}\n    if (rules && name) {\n      for (const key in validators) {\n        const validator = validators[key]\n        if (rules[key] && !validator(ref?.value)) {\n          _isValid = false\n          if (errors.current?.[name]?.[key]) continue\n          shouldRerender.current = true\n          if (name in errors.current) {\n            errors.current[name][key] = messages?.[key]\n          } else {\n            errors.current[name] = {\n              [key]: messages?.[key],\n              ...errors.current[name]\n            }\n          }\n          elements.current.set(ref, {\n            ...(elements.current.get(ref) as DataField),\n            valid: false\n          })\n        } else {\n          if (!errors.current?.[name]?.[key]) continue\n          shouldRerender.current = true\n          delete errors.current?.[name]?.[key]\n          if (!isEmpty(errors?.current) && isEmpty(errors?.current?.[name])) {\n            isEmpty(errors.current?.[name]) && delete errors.current?.[name]\n            errors.current = { ...errors.current }\n            elements.current.set(ref, {\n              ...(elements.current.get(ref) as DataField),\n              valid: true\n            })\n          }\n        }\n      }\n    }\n    if (!_isValid) {\n      formValidity.current = false\n    }\n\n    if (isEmpty(errors.current)) {\n      shouldRerender.current = true\n      formValidity.current = true\n    }\n\n    if (shouldRerender.current) {\n      shouldRerender.current = false\n      rerender({})\n    }\n  }\n\n  const detectInput = (ref: RefObject<BasicRefs>) => (e: Event) => {\n    e.stopPropagation()\n    if (!dirtyElements.current.has(ref.current)) {\n      dirtyElements.current.set(ref.current, null)\n    }\n    if (\n      !triedToSubmit.current &&\n      customConfiguration.current.validateFormOnSubmit\n    )\n      return\n    fieldValidation(ref.current!)\n  }\n\n  const detectChange = (ref: RefObject<BasicRefs>) => (e: Event) => {\n    e.stopPropagation()\n    const name = ref.current?.name\n    if (isRadio(ref.current!) && name) {\n      console.log(findElementsWithSameName(elements, name))\n    }\n  }\n\n  const track = (elem?: BasicRefs, rules?: Rules): void => {\n    if (!elem) return\n    const ref = createRef<BasicRefs>()\n    ;(ref as React.MutableRefObject<BasicRefs>).current = elem\n    // console.log(ref)\n    if (ref.current?.type === 'radio') {\n      ref.current && ref.current.addEventListener('change', detectChange(ref))\n    } else {\n      if (elements.current.has(ref.current!)) return\n      ref.current && ref.current.addEventListener('focus', detectTouch(ref))\n      ref.current && ref.current.addEventListener('input', detectInput(ref))\n    }\n    const validators = getValidators(\n      customValidators.current,\n      builtInValidators,\n      rules\n    )\n    const name = hasNameAttribute(ref.current!)\n    const dataFields: DataField = {\n      valid: true,\n      ...(rules && { fieldRules: rules }),\n      ...(validators && { validators }),\n      type: ref.current?.type,\n      name: name,\n      ...(isRadio(ref.current!) && { checked: false }),\n      ...(isRadio(ref.current!) && { group: [] })\n    }\n\n    elements.current.set(ref.current!, dataFields)\n  }\n\n  const detectTouch = (ref: RefObject<BasicRefs>) => () => {\n    touchedElements.current.set(ref, null)\n    ref.current &&\n      ref.current.removeEventListener('focus', detectTouch(ref), true)\n  }\n\n  return {\n    track: track,\n    submitForm: submitForm,\n    errors: errors.current,\n    formValidity: formValidity.current\n  }\n}\n"],"names":["required","input","trim","length","email","test","minLen","len","toString","checkForValidators","configValidators","builtInValidators","name","data","customValidators","Error","getValidators","f","key","rules","t","hasNameAttribute","ref","console","warn","outerHTML","undefined","isRadio","type","findElementsWithSameName","elements","sn","current","forEach","value","push","isEmpty","o","Array","isArray","Object","keys","constructor","useValidator","config","useRef","Map","touchedElements","dirtyElements","errors","customConfiguration","triedToSubmit","formValidity","shouldRerender","useState","rerender","submitForm","fn","e","preventDefault","prevFormValidity","size","_value","fieldValidation","useEffect","validateFormOnSubmit","_isValid","get","fieldRules","validators","messages","validator","set","valid","detectInput","stopPropagation","has","detectChange","log","track","elem","createRef","addEventListener","detectTouch","dataFields","checked","group","removeEventListener"],"mappings":"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"}