import{useRef as r,useState as n,useEffect as e,createRef as t}from"react";function u(){return(u=Object.assign||function(r){for(var n=1;n<arguments.length;n++){var e=arguments[n];for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(r[t]=e[t])}return r}).apply(this,arguments)}var o=function(r){return Array.isArray(r)?!r.length:0===Object.keys(r).length&&r.constructor===Object},c=function(r){return Array.isArray(r)},i={required:function(r){return"string"==typeof r?r.trim().length>0:"number"==typeof r?!!r:!(!r||"object"!=typeof r||o(r))},email:function(r){return/^\w+([-]?\w+)*@\w+([-]?\w+)*(\.\w{2,3})+$/.test(r)},minLength:function(r,n){return n||console.warn("length is not provided"),r.toString().length>=n},maxLength:function(r,n){return n||console.warn("length is not provided"),r.toString().length<=n},minCheckboxes:function(r,n){return void 0===n&&(n=null),!("object"!=typeof r||!c(r)||!n||"number"!=typeof n)&&r.length>=n}},l=function(r,n,e,t){var u;return(null==t||null===(u=t.customValidators)||void 0===u?void 0:u[e])?t.customValidators[e]:(null==r?void 0:r[e])?r[e]:n[e]?n[e]:void console.warn("no validation function with mane "+e)},a=function(r){return"radio"===r.type},v=function(r){return"checkbox"===r.type},f=function(r){if("checkbox"===r.type||"radio"===r.type){if(r.ref)return r.ref.current&&r.ref.current.checked?r.ref.current.value:null;if(!o(r.group)&&c(r.group))return r.group.filter(function(r){return r.current.checked}).map(function(r){return r.current.value})}return r.ref.current?r.ref.current.value:null},d=function(r,n,e){var t,u;return void 0===r&&(r=null),void 0===n&&(n=null),(null===(t=r)||void 0===t?void 0:t[e])||(null===(u=n)||void 0===u?void 0:u[e])||void 0},s=function(r){return function(n){return r||console.warn(n),r}},p=function(r,n){return r&&n in r},g=function(c){var g=r(new Map),m=r(new Map),h=r(new Map),y=r({}),b=r(!1),w=r(!0),k=r(!1),O=n()[1];e(function(){g.current.forEach(function(r){var n;("object"==typeof(n=f(r))&&null!==n?!o(n):"number"==typeof n?n||0===n:"string"==typeof n?n.trim():n)&&j(r)})},[]);var j=function(r){var n=!0,e=u({},y.current),t=g.current.get(r.name)||{},i=t.validators,l=t.name,a=t.fieldRules||{},v=a.rules,m=a.messages,h=a.options;if(v&&l)for(var b in i){var j=i[b],L=d(h,null==c?void 0:c.globalOptions,b),E=f(r);if(v[b]&&!j(E,L)){var M;if(n=!1,p(null===(M=y.current)||void 0===M?void 0:M[l],b))continue;k.current=!0;var x=s(d(m,null==c?void 0:c.globalMessages,b))("no @ "+b+" error message anywhere for "+l+" input.");y.current[l]=y.current[l]||{},y.current[l][b]=x,g.current.set(l,u({},g.current.get(l),{valid:!1}))}else{var A,S,V,F,P,q,z;if(!(null===(A=y.current)||void 0===A||null===(S=A[l])||void 0===S?void 0:S[b]))continue;k.current=!0,null===(V=y.current)||void 0===V||null===(F=V[l])||void 0===F||delete F[b],!o(null==y?void 0:y.current)&&o(null==y||null===(P=y.current)||void 0===P?void 0:P[l])&&(o(null===(q=y.current)||void 0===q?void 0:q[l])&&(null===(z=y.current)||void 0===z||delete z[l]),y.current=u({},y.current),g.current.set(l,u({},g.current.get(l),{valid:!0})))}}n||(w.current=!1),o(y.current)&&!o(e)&&(k.current=!0,w.current=!0),k.current&&(k.current=!1,O({}))};return{track:function(r,n){var e;if(r){var o=t();o.current=r;var f=function(r){return r.name||void console.warn("the field @ "+r.outerHTML+" must have a unique name attribute")}(o.current);if(f){var d,s=a(o.current)||v(o.current),p=g.current.get(f);g.current.has(f)&&(null==p?void 0:p.group)&&p.group.some(function(r){return r.current===o.current})||(a(o.current)||v(o.current)||"range"===(null===(d=o.current)||void 0===d?void 0:d.type)?o.current&&o.current.addEventListener("change",function(r){return function(n){var e;if(n.stopPropagation(),b.current||!(null==c?void 0:c.validateFormOnSubmit)){var t=null===(e=r.current)||void 0===e?void 0:e.name,u=r.current&&g.current.get(t);j(u)}}}(o)):(o.current&&o.current.addEventListener("focus",function r(n){return function(){var e;m.current.set(null===(e=n.current)||void 0===e?void 0:e.name,null),n.current&&n.current.removeEventListener("focus",r(n),!0)}}(o)),o.current&&o.current.addEventListener("input",function(r){return function(n){var e;n.stopPropagation();var t=null===(e=r.current)||void 0===e?void 0:e.name;if(h.current.has(r.current)||h.current.set(r.current,null),b.current||!(null==c?void 0:c.validateFormOnSubmit)){var u=g.current.get(t);j(u)}}}(o))));var y=function(r,n,e){if(e){var t={};for(var u in null==e?void 0:e.rules){var o=l(r,n,u,e);o&&(t[u]=o)}return t}}(null==c?void 0:c.customValidators,i,n),w=g.current.get(f)||u({valid:!0},n&&{fieldRules:n},y&&{validators:y},{type:null===(e=o.current)||void 0===e?void 0:e.type,name:f},s&&{checked:!1},s&&{group:[]},{ref:o});g.current.has(f)&&(w.ref&&w.group&&w.group.push(w.ref),w.group&&!w.group.some(function(r){return r.current===o.current})&&(w.group.push(o),delete w.ref)),g.current.set(f,w)}}},submitForm:function(r){return function(n){n.preventDefault();var e=w.current;g.current.size!==h.current.size&&(h.current=new Map(g.current)),g.current.forEach(function(r){j(r)}),b.current=!0,w.current===e?r&&r():O({})}},errors:y.current,formValidity:w.current}};export{g as useValidator};
//# sourceMappingURL=index.modern.js.map
